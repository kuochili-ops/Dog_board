<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Precision Blackboard Sync</title>
    <style>
        :root { --duration: 3.5s; }
        body { background: #111; color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
        
        .stage {
            position: relative;
            width: 100%;
            max-width: 800px;
            perspective: 1200px; /* 模擬相機焦距 */
            overflow: hidden;
            background: #000;
        }

        video { width: 100%; display: block; }

        /* 文字圖形層：尺寸與黑板一致 */
        #textCanvas {
            position: absolute;
            /* 定位到黑板在影片中的最終座標範圍 */
            top: 54%;
            left: 55%;
            width: 33%;  /* 對應黑板寬度 */
            height: 43%; /* 對應黑板高度 */
            
            pointer-events: none;
            z-index: 10;
            
            /* 關鍵：設置旋轉軸心在黑板頂部吊繩處 */
            transform-origin: 50% 0%; 
            
            /* 初始狀態：完全倒貼在黑板背面 */
            transform: translate(-50%, -0%) rotateX(-105deg);
            opacity: 0;
            
            /* 優化渲染 */
            will-change: transform, opacity;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* 模擬黑板逆向追蹤動畫 */
        @keyframes boardTracker {
            0% {
                opacity: 0;
                transform: translate(-50%, -0%) rotateX(-105deg) rotateY(15deg);
            }
            40% {
                /* 剛翻過 90 度，文字開始顯現 */
                opacity: 1;
                transform: translate(-51%, -2%) rotateX(-80deg) rotateY(15deg) rotateZ(-3deg);
            }
            75% {
                opacity: 1;
                transform: translate(-53%, -4%) rotateX(-20deg) rotateY(12deg) rotateZ(-1deg);
            }
            100% {
                /* 最終狀態：左高右低的透視形狀 */
                opacity: 1;
                transform: translate(-53.5%, -5%) rotateX(0deg) rotateY(11deg) rotateZ(0deg);
            }
        }

        .active { animation: boardTracker var(--duration) linear forwards; }

        .controls { padding: 20px; width: 100%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; font-size: 16px; background: #222; color: #fff; }
        button { width: 100%; padding: 12px; background: #f1c40f; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="stage">
        <video id="v" playsinline webkit-playsinline muted>
            <source src="dog_board.mp4" type="video/mp4">
        </video>
        <canvas id="textCanvas"></canvas>
    </div>

    <div class="controls">
        <input type="text" id="userInput" placeholder="輸入要加註在黑板的文字...">
        <button onclick="startSync()">執行同步加註</button>
    </div>

    <script>
        const canvas = document.getElementById('textCanvas');
        const ctx = canvas.getContext('2d');
        const video = document.getElementById('v');
        const input = document.getElementById('userInput');

        function generateTextImage(text) {
            // 1. 設定畫布尺寸（模擬黑板比例）
            canvas.width = 400;
            canvas.height = 300;
            
            // 2. 清除畫布（透明底）
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 3. 繪製白色文字
            ctx.fillStyle = "white";
            ctx.font = "bold 48px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            
            // 處理多行或過長文字可在此擴充
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
        }

        function startSync() {
            const text = input.value || "這下對了吧！";
            
            // 生成圖像
            generateTextImage(text);
            
            // 重置狀態
            canvas.classList.remove('active');
            video.pause();
            video.currentTime = 0;
            
            void canvas.offsetWidth; // Reflow
            
            // 同步啟動
            video.play();
            canvas.classList.add('active');
        }
    </script>
</body>
</html>
