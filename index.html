<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Dog Blackboard Matrix Sync</title>
    <style>
        body { background: #000; color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
        .stage { position: relative; width: 100%; max-width: 800px; perspective: 1200px; }
        video { width: 100%; display: block; }

        /* 文字圖形層：透明底白色字圖形 */
        #textCanvas {
            position: absolute;
            /* 定位於黑板最終停止時的中心點範圍 */
            top: 54.5%; 
            left: 55%;
            width: 32%; 
            height: 42%;
            
            z-index: 10;
            pointer-events: none;
            
            /* 關鍵修正：旋轉軸心必須鎖死在頂部，對齊吊繩位置 */
            transform-origin: center top; 
            
            /* 修正手機渲染與背面隱藏 */
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            transform-style: preserve-3d;
            
            /* 初始狀態：完全倒貼在背面 */
            transform: translate(-50%, 0%) rotateX(-90deg);
            opacity: 0;
            will-change: transform, opacity;
        }

        /* 根據影片逐幀紀錄的運動軌跡 */
        @keyframes preciseFlip {
            0% {
                opacity: 0;
                transform: translate(-50%, -5%) rotateX(-90deg) rotateY(15deg);
            }
            /* 1.5s: 剛叼過 90 度，文字瞬間顯現 */
            45% {
                opacity: 1;
                transform: translate(-51.5%, -3%) rotateX(-65deg) rotateY(18deg) rotateZ(-3deg) scale(0.95);
            }
            /* 2.2s: 接近翻正，模擬向心力導致的位移 */
            80% {
                opacity: 1;
                transform: translate(-53%, -1%) rotateX(-15deg) rotateY(14deg) rotateZ(-1deg) scale(1.05);
            }
            /* 2.8s: 最終定格位置 (對應影片最後一幀的梯形位置) */
            100% {
                opacity: 1;
                transform: translate(-53.5%, 0%) rotateX(0deg) rotateY(13.5deg) rotateZ(0deg) scale(1.1);
            }
        }

        .active {
            animation: preciseFlip 3.5s linear forwards;
        }

        .ui { padding: 20px; width: 100%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; font-size: 16px; background: #222; color: #fff; }
        button { width: 100%; padding: 12px; background: #FFD700; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="stage">
        <video id="v" playsinline webkit-playsinline muted>
            <source src="dog_board.mp4" type="video/mp4">
        </video>
        <canvas id="textCanvas"></canvas>
    </div>

    <div class="ui">
        <input type="text" id="userInput" placeholder="輸入要寫在黑板上的話...">
        <button onclick="run()">同步加註</button>
    </div>

    <script>
        const canvas = document.getElementById('textCanvas');
        const ctx = canvas.getContext('2d');
        const video = document.getElementById('v');
        const input = document.getElementById('userInput');

        function generateTexture(text) {
            // 繪製白色透明底圖形
            canvas.width = 512;
            canvas.height = 384;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = "white";
            ctx.font = "bold 60px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
        }

        function run() {
            generateTexture(input.value || "這下對齊了！");
            
            canvas.classList.remove('active');
            video.pause();
            video.currentTime = 0;
            
            void canvas.offsetWidth; 
            
            video.play();
            canvas.classList.add('active');
        }
    </script>
</body>
</html>
