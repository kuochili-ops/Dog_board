<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step-by-Step Tracker</title>
    <style>
        body { background: #111; color: #fff; font-family: monospace; display: flex; flex-direction: column; align-items: center; padding: 10px; }
        .stage { position: relative; cursor: crosshair; border: 2px solid #0f0; margin-bottom: 10px; max-width: 90vw; }
        video { display: block; width: 100%; height: auto; }
        .dot { position: absolute; width: 8px; height: 8px; background: red; border: 1px solid white; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; }
        .controls { background: #222; padding: 15px; border-radius: 10px; width: 100%; max-width: 600px; text-align: center; }
        #log { white-space: pre-wrap; background: #000; color: #0f0; padding: 10px; margin-top: 10px; border: 1px solid #333; height: 120px; overflow-y: auto; text-align: left; font-size: 11px; }
        .btn-group { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .info { color: #aaa; font-size: 12px; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div class="info">指示：點擊影片暫停/播放。暫停時點選黑板四角（左上→右上→左下→右下）</div>
    
    <div class="stage" id="stage">
        <video id="v" playsinline>
            <source src="dog_board.mp4" type="video/mp4">
        </video>
    </div>

    <div class="controls">
        <div>時間: <span id="timeDisplay">0.00</span>s | 已標註: <span id="dotCount">0</span>/4</div>
        <div class="btn-group">
            <button onclick="recordFrame()" style="background: #27ae60; color: white;">儲存此幀數據</button>
            <button onclick="resetCurrentDots()" style="background: #555; color: white;">重選此幀</button>
        </div>
        <div id="log">等待紀錄...</div>
    </div>

    <script>
        const stage = document.getElementById('stage');
        const video = document.getElementById('v');
        const log = document.getElementById('log');
        const timeDisplay = document.getElementById('timeDisplay');
        const dotCount = document.getElementById('dotCount');
        
        let currentDots = [];
        let allKeyframes = [];

        // 點擊影片切換播放/暫停
        video.onclick = () => { video.paused ? video.play() : video.pause(); };
        video.ontimeupdate = () => { timeDisplay.innerText = video.currentTime.toFixed(2); };

        stage.addEventListener('mousedown', function(e) {
            if (currentDots.length >= 4) return;
            
            // 點擊時自動暫停，方便精確點選
            video.pause();

            const rect = stage.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(2);
            const y = ((e.clientY - rect.top) / rect.height * 100).toFixed(2);
            
            currentDots.push({x, y});
            dotCount.innerText = currentDots.length;

            const div = document.createElement('div');
            div.className = 'dot';
            div.style.left = x + '%';
            div.style.top = y + '%';
            stage.appendChild(div);
        });

        function recordFrame() {
            if (currentDots.length < 4) { alert("請先點選四個角！"); return; }
            
            const frameData = {
                time: video.currentTime.toFixed(2),
                coords: [...currentDots]
            };
            allKeyframes.push(frameData);
            updateLog();
            resetCurrentDots();
            // 存完後提醒使用者可以繼續播放
            log.scrollTop = log.scrollHeight;
        }

        function resetCurrentDots() {
            currentDots = [];
            dotCount.innerText = "0";
            document.querySelectorAll('.dot').forEach(d => d.remove());
        }

        function updateLog() {
            log.innerText = "請複製此 JSON 貼給 AI：\n" + JSON.stringify(allKeyframes, null, 2);
        }
    </script>
</body>
</html>
