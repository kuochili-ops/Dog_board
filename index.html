<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Keyframe Tracker</title>
    <style>
        body { background: #111; color: #0f0; font-family: monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .stage { position: relative; cursor: crosshair; border: 2px solid #444; margin-bottom: 10px; }
        video { display: block; max-width: 100%; height: auto; }
        .dot { position: absolute; width: 8px; height: 8px; background: red; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; }
        .controls { background: #222; padding: 15px; border-radius: 10px; width: 100%; max-width: 600px; }
        #log { white-space: pre-wrap; background: #000; color: #fff; padding: 10px; margin-top: 10px; border: 1px solid #333; height: 150px; overflow-y: auto; font-size: 12px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="stage" id="stage">
        <video id="v" controls>
            <source src="dog_board.mp4" type="video/mp4">
        </video>
    </div>

    <div class="controls">
        <div>目前時間: <span id="timeDisplay">0.00</span>s</div>
        <button onclick="recordFrame()" style="background: #27ae60; color: white;">● 紀錄此影格座標</button>
        <button onclick="resetDots()" style="background: #e74c3c; color: white;">清除當前點</button>
        <div id="log">尚未紀錄數據...</div>
    </div>

    <script>
        const stage = document.getElementById('stage');
        const video = document.getElementById('v');
        const log = document.getElementById('log');
        const timeDisplay = document.getElementById('timeDisplay');
        
        let currentDots = [];
        let allKeyframes = [];

        video.ontimeupdate = () => { timeDisplay.innerText = video.currentTime.toFixed(2); };

        stage.addEventListener('mousedown', function(e) {
            if (currentDots.length >= 4) return;
            const rect = stage.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(2);
            const y = ((e.clientY - rect.top) / rect.height * 100).toFixed(2);
            
            currentDots.push({x, y});
            const div = document.createElement('div');
            div.className = 'dot';
            div.style.left = x + '%';
            div.style.top = y + '%';
            stage.appendChild(div);
        });

        function recordFrame() {
            if (currentDots.length < 4) { alert("請先點選四個角！"); return; }
            
            const frameData = {
                time: video.currentTime.toFixed(2),
                coords: [...currentDots]
            };
            allKeyframes.push(frameData);
            updateLog();
            resetDots();
        }

        function resetDots() {
            currentDots = [];
            document.querySelectorAll('.dot').forEach(d => d.remove());
        }

        function updateLog() {
            log.innerText = "請複製下方數據給 AI：\n\n" + JSON.stringify(allKeyframes, null, 2);
        }
    </script>
</body>
</html>
