<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pixel Perfect Sync</title>
    <style>
        body { background: #000; margin: 0; display: flex; flex-direction: column; align-items: center; color: white; font-family: sans-serif; }
        .stage { position: relative; width: 100%; max-width: 800px; }
        video { width: 100%; display: block; }

        /* 文字容器：強制填滿整個影片區域，以便使用你的百分比座標 */
        #textLayer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            display: none;
            
            /* 使用白色背景與黑色字（或反過來），確保「白色字透明底」的圖形感 */
            background: rgba(255,255,255,0); 
            transition: opacity 0.3s;
        }

        #textCanvas {
            width: 100%; height: 100%;
            /* 關鍵：使用 clip-path 依據你的座標剪裁出黑板形狀 */
            clip-path: polygon(45% 48%, 55% 48%, 55% 52%, 45% 52%); /* 初始：影片中央的一小點 */
        }

        /* 根據你提供的 FINAL_COORDS 進行變形動畫 */
        @keyframes morphToBoard {
            0% { 
                opacity: 0;
                clip-path: polygon(50% 50%, 50% 50%, 50% 50%, 50% 50%);
            }
            /* 1.1s 狗狗開始叼起 */
            31% { opacity: 0; }
            /* 1.5s 翻面瞬間 */
            45% { opacity: 1; }
            /* 2.8s 抵達你標註的精確位置 */
            100% { 
                opacity: 1;
                /* 座標依序：LT, RT, RB, LB */
                clip-path: polygon(
                    44.51% 37.68%, 
                    60.21% 49.43%, 
                    60.65% 79.34%, 
                    44.17% 69.30%
                );
            }
        }

        .active { display: block !important; animation: morphToBoard 3.5s linear forwards; }

        .ui { padding: 20px; width: 100%; }
        input { width: 80%; padding: 12px; border-radius: 8px; border: none; font-size: 16px; }
        button { padding: 12px 24px; background: #f1c40f; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="stage">
        <video id="v" playsinline webkit-playsinline muted>
            <source src="dog_board.mp4" type="video/mp4">
        </video>
        <div id="textLayer">
            <canvas id="textCanvas"></canvas>
        </div>
    </div>

    <div class="ui">
        <input type="text" id="userInput" placeholder="輸入文字...">
        <button onclick="startSync()">執行</button>
    </div>

    <script>
        const canvas = document.getElementById('textCanvas');
        const ctx = canvas.getContext('2d');
        const video = document.getElementById('v');
        const layer = document.getElementById('textLayer');

        function drawText(text) {
            // 讓畫布解析度與螢幕同步
            canvas.width = canvas.clientWidth * 2;
            canvas.height = canvas.clientHeight * 2;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 繪製文字：位置設定在四個座標的中點區域
            ctx.fillStyle = "white";
            ctx.font = "900 120px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            
            // 座標中點約在 52% / 58% 處
            ctx.fillText(text, canvas.width * 0.52, canvas.height * 0.58);
        }

        function startSync() {
            drawText(document.getElementById('userInput').value || "這下準了");
            layer.classList.remove('active');
            video.pause();
            video.currentTime = 0;
            void layer.offsetWidth;
            video.play();
            layer.classList.add('active');
        }
    </script>
</body>
</html>
