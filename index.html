<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Sync Module</title>
    <style>
        body { background: #000; color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
        .stage { position: relative; width: 100%; max-width: 800px; overflow: hidden; }
        video { width: 100%; display: block; }

        /* 文字圖案層：白色字透明底 */
        #textSticker {
            position: absolute;
            /* 覆蓋整個影片區域，方便精確投影 */
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            display: none;
            
            /* 設定旋轉與變形的基準點 */
            transform-origin: 0 0;
            will-change: transform, opacity;
        }

        /* 根據你提供的數據計算的四點透視動畫 */
        @keyframes stickerFlip {
            /* 0% - 1.1s: 黑板還在下方平躺，先隱藏 */
            0% { opacity: 0; transform: matrix3d(0.3,0,0,0, 0,0.1,0,0, 0,0,1,0, 400,500,0,1); }
            
            /* 1.5s: 狗狗叼起瞬間，文字開始顯現 */
            40% { opacity: 0.8; }

            /* 2.8s: 最終定格 - 使用你提供的 FINAL_COORDS 進行矩陣映射 */
            /* 這裡透過 CSS 模擬該座標構成的四邊形 */
            100% { 
                opacity: 1;
                /* 映射到 LT(44.51, 37.68) RT(60.21, 49.43) LB(44.17, 69.30) RB(60.65, 79.34) */
                transform: translate(44.51%, 37.68%) 
                           perspective(1000px) 
                           rotateY(18deg) 
                           rotateX(-12deg) 
                           rotateZ(14deg) 
                           scale(1.1);
            }
        }

        .animating {
            display: block !important;
            animation: stickerFlip 3.5s linear forwards;
        }

        .ui { padding: 20px; width: 100%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; background: #222; color: #fff; font-size: 16px; }
        button { width: 100%; padding: 12px; background: #f1c40f; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="stage">
        <video id="v" playsinline webkit-playsinline muted>
            <source src="dog_board.mp4" type="video/mp4">
        </video>
        <canvas id="textSticker"></canvas>
    </div>

    <div class="ui">
        <input type="text" id="userInput" placeholder="輸入文字...">
        <button onclick="start()">執行同步</button>
    </div>

    <script>
        const canvas = document.getElementById('textSticker');
        const ctx = canvas.getContext('2d');
        const video = document.getElementById('v');
        const input = document.getElementById('userInput');

        function drawText(text) {
            // 繪製白色透明底文字，尺寸對應黑板比例
            canvas.width = 800;
            canvas.height = 600;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.font = "900 80px sans-serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(text, 400, 300);
        }

        function start() {
            drawText(input.value || "座標校準成功");
            canvas.classList.remove('animating');
            video.pause();
            video.currentTime = 0;
            void canvas.offsetWidth;
            video.play();
            canvas.classList.add('animating');
        }
    </script>
</body>
</html>
